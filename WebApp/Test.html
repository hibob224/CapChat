<!DOCTYPE HTML>
<html>
	<head>
		<title>CaptChat</title>
		<script type="text/javascript" src='http://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js'></script>
		<script type="text/javascript" src='scripts/Font.js'></script>
		<script type="text/javascript">
			$((function() {
				//Preloads font
				CaptChat.tCtx   = document.getElementById('textCanvas').getContext('2d');
				var font        = new Font();
				font.src        = "Fonts/moms.ttf";
				font.fontFamily = "MomsTypewriter";
				//Displays 'First' Captcha once font is ready
				font.onload = function () {
					CaptChat.captchaIfy("onLoad");
				}

            }));
            CaptChat = {
				tCtx: {}, //Canvas context will be assigned here on page load
				runScript: function(e) {
					if (e.keyCode == 13) {
						var input = document.getElementById('input');
						CaptChat.captchaIfy(input.value);
						CaptChat.appendImg(CaptChat.canvasToImg());
						document.getElementById('textCanvas').getContext('2d').clearRect(0,0,400,30)
						input.value = '';
					}
				},

				captchaIfy: function(input) {
					CaptChat.tCtx.font = "normal 24px MomsTypewriter";	//Set text fonts option for  canvas,html5 canvas: Text Option
					CaptChat.tCtx.strokeStyle = "#000000";				//HTML5 canvas: Text Option
					CaptChat.tCtx.clearRect(0,0,400,30);				//Clear previous Canvas for redraw our captcha
					CaptChat.tCtx.strokeText(input,30,20,370);			//Stroke random string to canvas
					CaptChat.tCtx.textBaseline = "middle";				//HTML5 canvas: Text Option,line in middle of text
				},

				canvasToDataUrl: function(tCtx) {
					tCtx = tCtx || CaptChat.tCtx;
					return tCtx.canvas.toDataURL
				},

				canvasToImg: function(tCtx) {
					tCtx = tCtx || CaptChat.tCtx;;
					var	imageElem = document.createElement('img');
					imageElem.src = tCtx.canvas.toDataURL();

					return imageElem;
				},

				appendImg: function(img) {
					var messages = document.getElementById('messages');
					messages.appendChild(img);
				},
			};
		</script>
	</head>

	<body>
		<div>
			<ul id='messages' >
			</ul>
			<canvas id='textCanvas' width=400 height=30></canvas>
			<br>
		  	<input id="input" type=text onkeypress="CaptChat.runScript(event)">
		</div>
	</body>
</html>
